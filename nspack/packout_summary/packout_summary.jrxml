<?xml version="1.0" encoding="UTF-8"?>
<!-- Created with Jaspersoft Studio version 6.0.3.final using JasperReports Library version 6.0.0  -->
<!-- 2019-12-20T13:51:55 -->
<jasperReport xmlns="http://jasperreports.sourceforge.net/jasperreports" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://jasperreports.sourceforge.net/jasperreports http://jasperreports.sourceforge.net/xsd/jasperreport.xsd" name="packout_summary" pageWidth="595" pageHeight="842" columnWidth="555" leftMargin="20" rightMargin="20" topMargin="20" bottomMargin="20" uuid="a11c3b0e-77bc-47a3-bfcc-ddc9763f8ca9">
	<property name="com.jaspersoft.studio.data.defaultdataadapter" value="habata"/>
	<parameter name="detail_level" class="java.lang.String">
		<defaultValueExpression><![CDATA["Detail"]]></defaultValueExpression>
	</parameter>
	<parameter name="FromDate" class="java.sql.Date"/>
	<parameter name="ToDate" class="java.sql.Date"/>
	<queryString language="SQL">
		<![CDATA[with hsql as(
select 
production_runs.cultivar_id
,production_runs.orchard_id
,production_runs.season_id
,production_runs.puc_id
,sum(production_run_stats.bins_tipped_weight)bins_tipped_weight
,sum(production_run_stats.bins_tipped)bins_tipped
, cultivars.description as cultivar_description ,orchards.orchard_code,pucs.puc_code,seasons.season_code
,min( production_runs.started_at)::date as fromdate
,max( production_runs.started_at)::date as todate
from production_runs 
join cultivars on production_runs.cultivar_id=cultivars.id
join orchards on production_runs.orchard_id=orchards.id
join seasons on production_runs.season_id=seasons.id
join pucs on production_runs.puc_id=pucs.id
join production_run_stats on  production_runs.id=production_run_stats.production_run_id
where production_runs.started_at::date between $P{FromDate}    and $P{ToDate} 
group by 
production_runs.cultivar_id
,production_runs.orchard_id
,production_runs.season_id
,production_runs.puc_id
, cultivars.description ,orchards.orchard_code,pucs.puc_code,seasons.season_code

)
,packout as( select production_runs.cultivar_id,production_runs.orchard_id,production_runs.season_id,production_runs.puc_id, hsql.bins_tipped_weight
 ,sum(vw_packout_details.nett_weight) as pack_nett_weight
,vw_packout_details.marketing_variety_code
,vw_packout_details.size_ref
,vw_packout_details.std_size
,vw_packout_details.basic_pack
,vw_packout_details.grade_code
,vw_packout_details.inventory_code
,hsql.cultivar_description ,hsql.orchard_code,hsql.puc_code,hsql.season_code
,hsql.cultivar_description ||hsql.orchard_code||hsql.puc_code||hsql.season_code as group1
,hsql.fromdate
,hsql.todate
from vw_packout_details 
 join production_runs on vw_packout_details.production_run_id =production_runs.id
join hsql on 
 production_runs.cultivar_id=hsql.cultivar_id and
production_runs.orchard_id=hsql.orchard_id and
production_runs.season_id=hsql.season_id and
production_runs.puc_id=hsql.puc_id
 where production_runs.started_at::date between $P{FromDate}    and $P{ToDate} 
 
 group by production_runs.cultivar_id,production_runs.orchard_id,production_runs.season_id,production_runs.puc_id, hsql.bins_tipped_weight
 ,vw_packout_details.marketing_variety_code
,vw_packout_details.size_ref
,vw_packout_details.std_size
,vw_packout_details.basic_pack
,vw_packout_details.grade_code
,vw_packout_details.inventory_code
,hsql.cultivar_description ,hsql.orchard_code,hsql.puc_code,hsql.season_code
,hsql.fromdate
,hsql.todate)
select *,
cast(pack_nett_weight/bins_tipped_weight*100 as dec(4,1)) detail_perc
,sum(pack_nett_weight) OVER (PARTITION BY group1) as packout_weight_group1, 
cast(sum(pack_nett_weight) OVER (PARTITION BY group1)/bins_tipped_weight*100 as dec(4,1))as packout_perc_group1 from packout

order by season_code,cultivar_description ,orchard_code,puc_code]]>
	</queryString>
	<field name="bins_tipped_weight" class="java.math.BigDecimal"/>
	<field name="pack_nett_weight" class="java.math.BigDecimal"/>
	<field name="marketing_variety_code" class="java.lang.String"/>
	<field name="size_ref" class="java.lang.String"/>
	<field name="std_size" class="java.lang.Integer"/>
	<field name="basic_pack" class="java.lang.String"/>
	<field name="grade_code" class="java.lang.String"/>
	<field name="inventory_code" class="java.lang.String"/>
	<field name="cultivar_description" class="java.lang.String"/>
	<field name="orchard_code" class="java.lang.String"/>
	<field name="puc_code" class="java.lang.String"/>
	<field name="season_code" class="java.lang.String"/>
	<field name="group1" class="java.lang.String"/>
	<field name="cultivar_id" class="java.lang.Integer"/>
	<field name="orchard_id" class="java.lang.Integer"/>
	<field name="season_id" class="java.lang.Integer"/>
	<field name="puc_id" class="java.lang.Integer"/>
	<field name="detail_perc" class="java.math.BigDecimal"/>
	<field name="packout_weight_group1" class="java.math.BigDecimal"/>
	<field name="packout_perc_group1" class="java.math.BigDecimal"/>
	<field name="fromdate" class="java.sql.Date"/>
	<field name="todate" class="java.sql.Date"/>
	<variable name="pack_nett_weight_SUM" class="java.math.BigDecimal" calculation="Sum">
		<variableExpression><![CDATA[$F{pack_nett_weight}]]></variableExpression>
	</variable>
	<variable name="Cultivar_header" class="java.lang.String" resetType="Group" resetGroup="group1" incrementType="Group" incrementGroup="group1">
		<variableExpression><![CDATA[$F{cultivar_description}]]></variableExpression>
	</variable>
	<variable name="PUC_header" class="java.lang.String" resetType="Group" resetGroup="group1" incrementType="Group" incrementGroup="group1">
		<variableExpression><![CDATA[$F{puc_code}]]></variableExpression>
	</variable>
	<variable name="Orchard_header" class="java.lang.String" resetType="Group" resetGroup="group1" incrementType="Group" incrementGroup="group1">
		<variableExpression><![CDATA[$F{orchard_code}]]></variableExpression>
	</variable>
	<variable name="Season_header" class="java.lang.String" resetType="Group" resetGroup="group1" incrementType="Group" incrementGroup="group1">
		<variableExpression><![CDATA[$F{season_code}]]></variableExpression>
	</variable>
	<group name="group1">
		<groupExpression><![CDATA[$F{group1}]]></groupExpression>
		<groupHeader>
			<band height="25">
				<textField isStretchWithOverflow="true" evaluationTime="Group" evaluationGroup="group1" isBlankWhenNull="true">
					<reportElement x="117" y="0" width="60" height="20" uuid="b246b077-3b19-4f2b-af0b-8bbd8606b340"/>
					<textFieldExpression><![CDATA[$V{Cultivar_header}]]></textFieldExpression>
				</textField>
				<textField isStretchWithOverflow="true" evaluationTime="Group" evaluationGroup="group1" isBlankWhenNull="true">
					<reportElement x="214" y="0" width="46" height="20" uuid="12ae40f1-fd56-410c-a2c1-97882b75b799"/>
					<textFieldExpression><![CDATA[$V{PUC_header}]]></textFieldExpression>
				</textField>
				<textField isStretchWithOverflow="true" evaluationTime="Group" evaluationGroup="group1" isBlankWhenNull="true">
					<reportElement x="310" y="0" width="70" height="20" uuid="18556890-0c9c-4873-9c95-cf8897d64c42"/>
					<textFieldExpression><![CDATA[$V{Orchard_header}]]></textFieldExpression>
				</textField>
				<textField pattern="#,##0.###">
					<reportElement x="516" y="0" width="38" height="20" uuid="1bb2d8b9-7d9e-4f42-8846-38ee1b7b0ce3">
						<property name="com.jaspersoft.studio.unit.height" value="px"/>
						<property name="com.jaspersoft.studio.unit.width" value="px"/>
					</reportElement>
					<textElement textAlignment="Right"/>
					<textFieldExpression><![CDATA[$F{packout_perc_group1}]]></textFieldExpression>
				</textField>
				<textField pattern="#,##0.###">
					<reportElement x="388" y="0" width="58" height="20" uuid="88fc868a-3ca8-498a-a8e4-337e9642bde6">
						<property name="com.jaspersoft.studio.unit.height" value="px"/>
						<property name="com.jaspersoft.studio.unit.width" value="px"/>
					</reportElement>
					<textElement textAlignment="Right"/>
					<textFieldExpression><![CDATA[$F{bins_tipped_weight}]]></textFieldExpression>
				</textField>
				<textField pattern="#,##0.###;(#,##0.###-)">
					<reportElement x="453" y="0" width="58" height="20" uuid="10dd23ae-a06d-4c01-82d6-62382b0bc8a7">
						<property name="local_mesure_unitheight" value="pixel"/>
						<property name="com.jaspersoft.studio.unit.height" value="px"/>
						<property name="local_mesure_unitwidth" value="pixel"/>
						<property name="com.jaspersoft.studio.unit.width" value="px"/>
					</reportElement>
					<textElement textAlignment="Right"/>
					<textFieldExpression><![CDATA[$F{packout_weight_group1}]]></textFieldExpression>
				</textField>
				<textField isStretchWithOverflow="true" evaluationTime="Group" evaluationGroup="group1" isBlankWhenNull="true">
					<reportElement x="1" y="0" width="64" height="20" uuid="00c949ca-8fe9-4683-a8d7-c8877695daa5"/>
					<textFieldExpression><![CDATA[$V{Season_header}]]></textFieldExpression>
				</textField>
				<textField>
					<reportElement x="65" y="0" width="52" height="20" uuid="31274851-a706-4830-b292-2b06bb7c7c5e"/>
					<textFieldExpression><![CDATA["Cultivar:"]]></textFieldExpression>
				</textField>
				<textField>
					<reportElement x="177" y="0" width="36" height="20" uuid="c6f896f9-4396-423a-a377-1cc571281651"/>
					<textFieldExpression><![CDATA["PUC:"]]></textFieldExpression>
				</textField>
				<textField>
					<reportElement x="260" y="0" width="50" height="20" uuid="7a3c072e-2e71-4983-bd91-127046f0c54f"/>
					<textFieldExpression><![CDATA["Orchard:"]]></textFieldExpression>
				</textField>
			</band>
		</groupHeader>
	</group>
	<background>
		<band splitType="Stretch"/>
	</background>
	<title>
		<band height="66" splitType="Stretch">
			<staticText>
				<reportElement x="1" y="0" width="369" height="30" uuid="38a0db5e-e7aa-47fb-a78e-796e8d25a4cb"/>
				<textElement textAlignment="Center">
					<font size="16"/>
				</textElement>
				<text><![CDATA[Packout Summary]]></text>
			</staticText>
			<staticText>
				<reportElement x="7" y="32" width="58" height="15" uuid="64b7ae3d-ea52-409f-a6a7-57a5b0857881">
					<property name="com.jaspersoft.studio.unit.height" value="px"/>
				</reportElement>
				<textElement textAlignment="Left"/>
				<text><![CDATA[From Date:]]></text>
			</staticText>
			<staticText>
				<reportElement x="7" y="48" width="58" height="15" uuid="c8456536-caf3-44bc-b153-4999b3774d29">
					<property name="com.jaspersoft.studio.unit.height" value="px"/>
				</reportElement>
				<textElement textAlignment="Left"/>
				<text><![CDATA[To Date:]]></text>
			</staticText>
			<line>
				<reportElement x="1" y="65" width="553" height="1" uuid="e7f2b06f-1e3b-4138-9ae5-90e95b278862">
					<property name="local_mesure_unitheight" value="pixel"/>
					<property name="com.jaspersoft.studio.unit.height" value="px"/>
				</reportElement>
			</line>
			<textField pattern="d MMM  yyyy">
				<reportElement x="446" y="2" width="70" height="15" uuid="0542fd86-a506-40c5-ad66-2d00ed4d16d8">
					<property name="com.jaspersoft.studio.unit.height" value="px"/>
				</reportElement>
				<textElement>
					<font fontName="SansSerif" size="8"/>
				</textElement>
				<textFieldExpression><![CDATA[new java.util.Date()]]></textFieldExpression>
			</textField>
			<textField pattern="HH:mm">
				<reportElement x="516" y="2" width="38" height="15" uuid="fc4c0dd2-b4f4-4895-a9b7-de063459403e">
					<property name="com.jaspersoft.studio.unit.height" value="px"/>
				</reportElement>
				<textElement textAlignment="Left">
					<font fontName="SansSerif" size="8"/>
				</textElement>
				<textFieldExpression><![CDATA[new java.util.Date()]]></textFieldExpression>
			</textField>
			<staticText>
				<reportElement x="370" y="2" width="76" height="15" uuid="34b858b5-732f-448b-be8c-9b0f3e5d8af0">
					<property name="local_mesure_unitheight" value="pixel"/>
					<property name="com.jaspersoft.studio.unit.height" value="px"/>
				</reportElement>
				<textElement textAlignment="Right">
					<font fontName="SansSerif" size="8"/>
				</textElement>
				<text><![CDATA[Print:]]></text>
			</staticText>
			<textField pattern="dd/M/yy">
				<reportElement x="71" y="32" width="96" height="15" uuid="2a1c7ef6-45f5-4e6a-b870-325842c218eb"/>
				<textFieldExpression><![CDATA[$F{fromdate}]]></textFieldExpression>
			</textField>
			<textField pattern="dd/M/yy">
				<reportElement x="71" y="48" width="96" height="15" uuid="abdb3004-cb2d-48ea-80e0-b1f4e64e83fb"/>
				<textFieldExpression><![CDATA[$F{todate}]]></textFieldExpression>
			</textField>
			<staticText>
				<reportElement x="388" y="34" width="58" height="30" uuid="324d92b7-b3b6-4be3-93fd-4a1c6a7142b9">
					<property name="com.jaspersoft.studio.unit.height" value="px"/>
					<property name="com.jaspersoft.studio.unit.width" value="px"/>
					<printWhenExpression><![CDATA[$P{detail_level}.equals("Summary")]]></printWhenExpression>
				</reportElement>
				<textElement textAlignment="Right"/>
				<text><![CDATA[tipped weight]]></text>
			</staticText>
			<staticText>
				<reportElement x="453" y="34" width="58" height="30" uuid="e75652ad-7cc6-4f15-b5f5-b999e1134838">
					<property name="com.jaspersoft.studio.unit.height" value="px"/>
					<property name="com.jaspersoft.studio.unit.width" value="px"/>
					<printWhenExpression><![CDATA[$P{detail_level}.equals("Summary")]]></printWhenExpression>
				</reportElement>
				<textElement textAlignment="Right"/>
				<text><![CDATA[pack nett weight]]></text>
			</staticText>
			<staticText>
				<reportElement x="516" y="34" width="38" height="30" uuid="d65b6106-e9bd-4bf7-a0f1-29cc99608a15">
					<printWhenExpression><![CDATA[$P{detail_level}.equals("Summary")]]></printWhenExpression>
				</reportElement>
				<textElement textAlignment="Right"/>
				<text><![CDATA[Pack Out %]]></text>
			</staticText>
		</band>
	</title>
	<columnHeader>
		<band height="30" splitType="Stretch">
			<printWhenExpression><![CDATA[$P{detail_level}.equals("Detail")]]></printWhenExpression>
			<staticText>
				<reportElement x="453" y="0" width="58" height="30" uuid="ffb541cc-3da1-4e4d-a780-29b69be9de31">
					<property name="com.jaspersoft.studio.unit.height" value="px"/>
					<property name="com.jaspersoft.studio.unit.width" value="px"/>
				</reportElement>
				<textElement textAlignment="Right"/>
				<text><![CDATA[pack nett weight]]></text>
			</staticText>
			<staticText>
				<reportElement x="106" y="0" width="30" height="30" uuid="81d6a602-c344-4109-8e1b-d2eb56e863a0">
					<property name="com.jaspersoft.studio.unit.height" value="px"/>
					<property name="com.jaspersoft.studio.unit.width" value="px"/>
				</reportElement>
				<text><![CDATA[size ref]]></text>
			</staticText>
			<staticText>
				<reportElement x="138" y="0" width="30" height="30" uuid="a6c32783-530f-439a-96ad-9577e842af3d">
					<property name="local_mesure_unitheight" value="pixel"/>
					<property name="com.jaspersoft.studio.unit.height" value="px"/>
					<property name="local_mesure_unitwidth" value="pixel"/>
					<property name="com.jaspersoft.studio.unit.width" value="px"/>
				</reportElement>
				<text><![CDATA[std size]]></text>
			</staticText>
			<staticText>
				<reportElement x="70" y="0" width="30" height="30" uuid="86c44f75-cf0a-44de-b12e-38d1a6400088">
					<property name="com.jaspersoft.studio.unit.height" value="px"/>
					<property name="com.jaspersoft.studio.unit.width" value="px"/>
				</reportElement>
				<text><![CDATA[basic pack]]></text>
			</staticText>
			<staticText>
				<reportElement x="38" y="0" width="30" height="30" uuid="2c4df7ac-ac41-4d2b-aa02-247079f7eb0d">
					<property name="com.jaspersoft.studio.unit.height" value="px"/>
					<property name="com.jaspersoft.studio.unit.width" value="px"/>
				</reportElement>
				<text><![CDATA[grade]]></text>
			</staticText>
			<staticText>
				<reportElement x="171" y="0" width="30" height="30" uuid="a6c8db6b-749c-4576-8ceb-13a13f47dfd7">
					<property name="com.jaspersoft.studio.unit.height" value="px"/>
					<property name="com.jaspersoft.studio.unit.width" value="px"/>
				</reportElement>
				<text><![CDATA[inv code]]></text>
			</staticText>
			<staticText>
				<reportElement x="516" y="0" width="38" height="30" uuid="0f26ad13-56b8-4d4f-87ad-2ee0b9114101"/>
				<textElement textAlignment="Right"/>
				<text><![CDATA[Pack Out %]]></text>
			</staticText>
			<staticText>
				<reportElement x="388" y="0" width="58" height="30" uuid="7c1c77f8-0b01-4260-b3a0-7abc64b15501">
					<property name="com.jaspersoft.studio.unit.height" value="px"/>
					<property name="com.jaspersoft.studio.unit.width" value="px"/>
				</reportElement>
				<textElement textAlignment="Right"/>
				<text><![CDATA[tipped weight]]></text>
			</staticText>
			<staticText>
				<reportElement x="0" y="0" width="38" height="30" uuid="ae08a5b3-2a3f-484f-94b2-ad2f91c8457a">
					<property name="com.jaspersoft.studio.unit.height" value="px"/>
					<property name="com.jaspersoft.studio.unit.width" value="px"/>
				</reportElement>
				<text><![CDATA[Variety]]></text>
			</staticText>
		</band>
	</columnHeader>
	<detail>
		<band height="15" splitType="Stretch">
			<printWhenExpression><![CDATA[$P{detail_level}.equals("Detail")]]></printWhenExpression>
			<textField pattern="#,##0.###;(#,##0.###-)">
				<reportElement x="453" y="0" width="58" height="15" uuid="545803f9-5516-4ef1-885a-544c1c9de1bb">
					<property name="local_mesure_unitheight" value="pixel"/>
					<property name="com.jaspersoft.studio.unit.height" value="px"/>
				</reportElement>
				<textElement textAlignment="Right"/>
				<textFieldExpression><![CDATA[$F{pack_nett_weight}]]></textFieldExpression>
			</textField>
			<textField>
				<reportElement x="0" y="0" width="34" height="15" uuid="9d368f53-6426-42c5-8b1b-49d0e3ae91d5">
					<property name="com.jaspersoft.studio.unit.height" value="px"/>
				</reportElement>
				<textFieldExpression><![CDATA[$F{marketing_variety_code}]]></textFieldExpression>
			</textField>
			<textField>
				<reportElement x="106" y="0" width="30" height="15" uuid="12584b66-1492-4b4b-857d-edfa2a9f5f03">
					<property name="com.jaspersoft.studio.unit.height" value="px"/>
				</reportElement>
				<textFieldExpression><![CDATA[$F{size_ref}]]></textFieldExpression>
			</textField>
			<textField isBlankWhenNull="true">
				<reportElement x="138" y="0" width="27" height="15" uuid="4e3d7521-6678-4b0f-8757-9f087237c20b">
					<property name="com.jaspersoft.studio.unit.height" value="px"/>
				</reportElement>
				<textFieldExpression><![CDATA[$F{std_size}]]></textFieldExpression>
			</textField>
			<textField>
				<reportElement x="70" y="0" width="27" height="15" uuid="b244081f-6259-44bc-ab01-e830139d40bf">
					<property name="com.jaspersoft.studio.unit.height" value="px"/>
				</reportElement>
				<textFieldExpression><![CDATA[$F{basic_pack}]]></textFieldExpression>
			</textField>
			<textField>
				<reportElement x="38" y="0" width="27" height="15" uuid="5208a019-a2e8-40a0-9f76-a987b58b79d2">
					<property name="com.jaspersoft.studio.unit.height" value="px"/>
				</reportElement>
				<textFieldExpression><![CDATA[$F{grade_code}]]></textFieldExpression>
			</textField>
			<textField>
				<reportElement x="173" y="0" width="27" height="15" uuid="94ef5967-ec38-4be3-8de0-1c5df1e3e98f">
					<property name="com.jaspersoft.studio.unit.height" value="px"/>
				</reportElement>
				<textFieldExpression><![CDATA[$F{inventory_code}]]></textFieldExpression>
			</textField>
			<textField pattern="#,##0.###">
				<reportElement x="388" y="0" width="58" height="15" uuid="77fc544d-ab7b-4519-862c-c9a42f41f515">
					<property name="local_mesure_unitheight" value="pixel"/>
					<property name="com.jaspersoft.studio.unit.height" value="px"/>
				</reportElement>
				<textElement textAlignment="Right"/>
				<textFieldExpression><![CDATA[$F{bins_tipped_weight}]]></textFieldExpression>
			</textField>
			<textField pattern="#,##0.###">
				<reportElement x="516" y="0" width="38" height="15" uuid="413abc07-146d-4d08-8a17-eef4f7ec5cd2"/>
				<textElement textAlignment="Right"/>
				<textFieldExpression><![CDATA[$F{detail_perc}]]></textFieldExpression>
			</textField>
		</band>
	</detail>
</jasperReport>
